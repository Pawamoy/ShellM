#!/bin/bash

## @file new
## @brief creates a new script in your shellm/usr/bin directory
## @depends shelp
## @package coreutils

## @desc This script creates a new file in your shellm/usr/bin directory,
## makes it executable, and write some lines in it, like the shebang
## #!/bin/bash, documentation lines (file, brief), and others, then
## open it for you to write the rest

include check.sh
include question.sh
include edit.sh
include usage.sh

check; [ $# -eq 0 ] && usage

main() {
    case $1 in
        ## @option -h, --help
        ## Prints this help and exit
        -h|--help) shelp -t "$0"; exit 0 ;;
    esac

    # Test if the script already exists
    if [ -f "${shellm}/bin/$1" ]; then
        err "$1 already exists in $shellm/bin"
        question "Would you like to overwrite it? [yN]" || return 0
    fi

    # Output the script headers in the file
    content='#!/bin/bash

## @file %s
## @brief %s
## @package coreutils

init; [ $# -eq 0 ] && usage

main() {
  case $1 in
    ## @option -h, --help
    ## Prints this help and exit.
    -h|--help) shellman -t "$0"; exit 0 ;;
  esac
}

## @synopsis -h
main "$@"
'
    printf "${content}" "$1" "$1" > "${shellm}/bin/$1"

    # Make it executable
    chmod +x "${shellm}/bin/$1"

    # Open the file
    [ ! -n "$2" ] &&
        { edit "${shellm}/bin/$1"; return $?; } ||
            eval $2 "${shellm}/bin/$1"
}

## @synopsis FILENAME [EDITOR]
main "$1" "$2"
