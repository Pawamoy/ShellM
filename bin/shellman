#!/usr/bin/env bash

main() {
  local OUTPUT SCRIPT REDIRECT=false FORMAT='text'

  while [ $# -ne 0 ]; do
    case $1 in
      ## @option -m, --man
      ## Output MAN documentation on stdout
      '-m'|'--man') FORMAT='man' ;;
      ## @option -s, --shellm
      ## Output MAN documentation in shellm/man/man1/FILE
      '-s'|'--shellm') FORMAT='man'; REDIRECT=true ;;
      ## @option -t, --text
      ## Outputs help text on stdout (synopsis, description, options, examples)
      '-t'|'--text') FORMAT='text' ;;
      ## @option -h, --help
      ## Print this help and exit
      '-h'|'--help') shellman -t "$0"; exit 0 ;;
      *) [ -f "$1" ] && SCRIPT="$1" ||
          die "shellman: $1: no such regular file" ;;
    esac
    shift
  done

  OUTPUT=$(SHELLMAN_FORMAT="$FORMAT" shellman.py "$SCRIPT")
  if ${REDIRECT}; then
    echo "$OUTPUT" > "$shellm/usr/man/man1/${SCRIPT##*/}.1"
  else
    echo "${OUTPUT}"
  fi
}

## \synopsis [-hmst] FILE
main "$@"